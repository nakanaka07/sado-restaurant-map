{
  "dashboard": {
    "id": null,
    "title": "‰ΩêÊ∏°È£≤È£üÂ∫ó„Éû„ÉÉ„Éó Phase 3-Full „Ç∑„Çπ„ÉÜ„É†Áõ£Ë¶ñ",
    "description": "Redis Cluster + Celery + ML Engine Áµ±ÂêàÁõ£Ë¶ñ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ",
    "tags": ["sado-restaurant", "phase3-full", "monitoring"],
    "timezone": "Asia/Tokyo",
    "refresh": "30s",
    "schemaVersion": 36,
    "version": 1,
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["15s", "30s", "1m", "5m", "15m"],
      "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
    },
    "templating": {
      "list": [
        {
          "name": "service",
          "type": "query",
          "query": "label_values(up, job)",
          "datasource": "Prometheus",
          "refresh": 1,
          "multi": true,
          "includeAll": true,
          "allValue": ".*"
        },
        {
          "name": "worker",
          "type": "query",
          "query": "label_values(celery_worker_up, worker)",
          "datasource": "Prometheus",
          "refresh": 1,
          "multi": true,
          "includeAll": true
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "title": "üöÄ „Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å",
        "type": "stat",
        "targets": [
          {
            "expr": "up{job=~\"$service\"}",
            "legendFormat": "{{job}} - {{instance}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                { "color": "red", "value": 0 },
                { "color": "green", "value": 1 }
              ]
            },
            "mappings": [
              { "options": { "0": { "text": "Down" } }, "type": "value" },
              { "options": { "1": { "text": "Up" } }, "type": "value" }
            ]
          }
        },
        "gridPos": { "h": 4, "w": 24, "x": 0, "y": 0 }
      },

      {
        "id": 2,
        "title": "üìä Redis Cluster Áä∂ÊÖã",
        "type": "table",
        "targets": [
          {
            "expr": "redis_up",
            "legendFormat": "{{addr}}"
          },
          {
            "expr": "redis_memory_used_bytes / 1024 / 1024",
            "legendFormat": "Memory (MB)"
          },
          {
            "expr": "redis_connected_clients",
            "legendFormat": "Clients"
          },
          {
            "expr": "redis_keyspace_hits_total / (redis_keyspace_hits_total + redis_keyspace_misses_total) * 100",
            "legendFormat": "Hit Rate %"
          }
        ],
        "transformations": [
          {
            "id": "groupBy",
            "options": {
              "fields": {
                "addr": { "aggregations": [], "operation": "groupby" },
                "Value": {
                  "aggregations": ["lastNotNull"],
                  "operation": "aggregate"
                }
              }
            }
          }
        ],
        "gridPos": { "h": 8, "w": 12, "x": 0, "y": 4 },
        "fieldConfig": {
          "defaults": {
            "custom": {
              "align": "auto",
              "displayMode": "auto"
            }
          },
          "overrides": [
            {
              "matcher": { "id": "byName", "options": "Hit Rate %" },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "mode": "thresholds"
                  }
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      { "color": "red", "value": 0 },
                      { "color": "yellow", "value": 70 },
                      { "color": "green", "value": 90 }
                    ]
                  }
                }
              ]
            }
          ]
        }
      },

      {
        "id": 3,
        "title": "‚ö° Celery Worker Áä∂ÊÖã",
        "type": "table",
        "targets": [
          {
            "expr": "celery_worker_up",
            "legendFormat": "{{worker}}"
          },
          {
            "expr": "celery_worker_tasks_active",
            "legendFormat": "Active Tasks"
          },
          {
            "expr": "celery_worker_load_average",
            "legendFormat": "Load Avg"
          },
          {
            "expr": "rate(celery_task_total[5m])",
            "legendFormat": "Tasks/sec"
          }
        ],
        "gridPos": { "h": 8, "w": 12, "x": 12, "y": 4 }
      },

      {
        "id": 4,
        "title": "üíæ Redis „É°„É¢„É™‰ΩøÁî®Èáè",
        "type": "timeseries",
        "targets": [
          {
            "expr": "redis_memory_used_bytes",
            "legendFormat": "{{addr}} Used"
          },
          {
            "expr": "redis_memory_max_bytes",
            "legendFormat": "{{addr}} Max"
          }
        ],
        "gridPos": { "h": 8, "w": 8, "x": 0, "y": 12 },
        "fieldConfig": {
          "defaults": {
            "unit": "bytes",
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 5,
        "title": "üî• Redis „Ç≥„Éû„É≥„ÉâÂÆüË°åÊï∞",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(redis_commands_processed_total[5m])",
            "legendFormat": "{{addr}}"
          }
        ],
        "gridPos": { "h": 8, "w": 8, "x": 8, "y": 12 },
        "fieldConfig": {
          "defaults": {
            "unit": "ops",
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 6,
        "title": "üìà „Ç≠„É£„ÉÉ„Ç∑„É•„Éí„ÉÉ„ÉàÁéá",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(redis_keyspace_hits_total[5m]) / (rate(redis_keyspace_hits_total[5m]) + rate(redis_keyspace_misses_total[5m])) * 100",
            "legendFormat": "{{addr}} Hit Rate"
          }
        ],
        "gridPos": { "h": 8, "w": 8, "x": 16, "y": 12 },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                { "color": "red", "value": 0 },
                { "color": "yellow", "value": 70 },
                { "color": "green", "value": 90 }
              ]
            }
          }
        }
      },

      {
        "id": 7,
        "title": "üîÑ Celery „Çø„Çπ„ÇØÂá¶ÁêÜÁä∂Ê≥Å",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(celery_task_total{state=\"SUCCESS\"}[5m])",
            "legendFormat": "ÊàêÂäü"
          },
          {
            "expr": "rate(celery_task_total{state=\"FAILURE\"}[5m])",
            "legendFormat": "Â§±Êïó"
          },
          {
            "expr": "rate(celery_task_total{state=\"RETRY\"}[5m])",
            "legendFormat": "„É™„Éà„É©„Ç§"
          }
        ],
        "gridPos": { "h": 8, "w": 12, "x": 0, "y": 20 },
        "fieldConfig": {
          "defaults": {
            "unit": "ops",
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 8,
        "title": "‚è±Ô∏è „Çø„Çπ„ÇØÂÆüË°åÊôÇÈñì",
        "type": "timeseries",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(celery_task_duration_seconds_bucket[5m]))",
            "legendFormat": "95%ile"
          },
          {
            "expr": "histogram_quantile(0.50, rate(celery_task_duration_seconds_bucket[5m]))",
            "legendFormat": "50%ile"
          }
        ],
        "gridPos": { "h": 8, "w": 12, "x": 12, "y": 20 },
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 9,
        "title": "ü§ñ ML Engine ÂàÜÊûêÁä∂Ê≥Å",
        "type": "stat",
        "targets": [
          {
            "expr": "ml_engine_analysis_total",
            "legendFormat": "Á∑èÂàÜÊûêÊï∞"
          },
          {
            "expr": "rate(ml_engine_analysis_total[5m]) * 60",
            "legendFormat": "ÂàÜÊûê/ÂàÜ"
          },
          {
            "expr": "ml_engine_anomaly_detected_total",
            "legendFormat": "Áï∞Â∏∏Ê§úÂá∫Êï∞"
          }
        ],
        "gridPos": { "h": 6, "w": 8, "x": 0, "y": 28 },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 10,
        "title": "üì± API „É™„ÇØ„Ç®„Çπ„ÉàÁä∂Ê≥Å",
        "type": "timeseries",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{status}}"
          }
        ],
        "gridPos": { "h": 6, "w": 8, "x": 8, "y": 28 },
        "fieldConfig": {
          "defaults": {
            "unit": "reqps",
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 11,
        "title": "üéØ API „É¨„Çπ„Éù„É≥„ÇπÊôÇÈñì",
        "type": "timeseries",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "95%ile"
          },
          {
            "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "50%ile"
          }
        ],
        "gridPos": { "h": 6, "w": 8, "x": 16, "y": 28 },
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },

      {
        "id": 12,
        "title": "üîç „Ç∑„Çπ„ÉÜ„É†„Ç¢„É©„Éº„Éà",
        "type": "logs",
        "targets": [
          {
            "expr": "{job=\"alertmanager\"} |= \"firing\"",
            "datasource": "Application-Logs"
          }
        ],
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 34 },
        "options": {
          "showTime": true,
          "showLabels": true,
          "sortOrder": "Descending"
        }
      },

      {
        "id": 13,
        "title": "üìä „Éì„Ç∏„Éç„Çπ„É°„Éà„É™„ÇØ„Çπ",
        "type": "stat",
        "targets": [
          {
            "expr": "restaurant_data_processed_total",
            "legendFormat": "Âá¶ÁêÜÊ∏à„ÅøÂ∫óËàóÊï∞"
          },
          {
            "expr": "api_requests_success_rate",
            "legendFormat": "APIÊàêÂäüÁéá"
          },
          {
            "expr": "cache_efficiency_percentage",
            "legendFormat": "„Ç≠„É£„ÉÉ„Ç∑„É•ÂäπÁéá"
          }
        ],
        "gridPos": { "h": 4, "w": 24, "x": 0, "y": 42 },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                { "color": "red", "value": 0 },
                { "color": "yellow", "value": 80 },
                { "color": "green", "value": 95 }
              ]
            }
          }
        }
      }
    ],

    "annotations": {
      "list": [
        {
          "name": "Deployments",
          "datasource": "Prometheus",
          "expr": "increase(deployment_timestamp[1m])",
          "iconColor": "blue",
          "titleFormat": "Deployment",
          "textFormat": "{{version}}"
        },
        {
          "name": "Alerts",
          "datasource": "Prometheus",
          "expr": "ALERTS{alertstate=\"firing\"}",
          "iconColor": "red",
          "titleFormat": "Alert: {{alertname}}"
        }
      ]
    }
  },

  "folderTitle": "‰ΩêÊ∏°È£≤È£üÂ∫ó„Éû„ÉÉ„Éó",
  "overwrite": true
}
