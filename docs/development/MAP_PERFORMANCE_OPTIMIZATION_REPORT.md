# ğŸš€ åœ°å›³ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– - æ”¹å–„ãƒ¬ãƒãƒ¼ãƒˆ

> **å®Ÿè£…æ—¥**: 2025å¹´9æœˆ14æ—¥
> **å¯¾è±¡**: RestaurantMap.tsx ãŠã‚ˆã³é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
> **ç›®çš„**: ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºã®åŠ¹ç‡çš„ãªç®¡ç†ã€ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„ã€é–‹ç™ºè€…ä½“é¨“å‘ä¸Š

## ğŸ“Š æ”¹å–„æ¦‚è¦

### ğŸ¯ **ä¸»è¦ãªæœ€é©åŒ–å®Ÿè£…**

| æ”¹å–„é ˜åŸŸ                  | å®Ÿè£…å†…å®¹                                               | æœŸå¾…åŠ¹æœ                    |
| ------------------------- | ------------------------------------------------------ | --------------------------- |
| **ğŸš€ ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºæœ€é©åŒ–** | å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ä»®æƒ³åŒ–ãƒ»åŠ¹ç‡çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° | ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚é–“ 50-70%å‘ä¸Š |
| **ğŸ§  ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–**       | React.memoãƒ»useMemoãƒ»useCallbackæ´»ç”¨                   | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ 30-40%å‰Šæ¸›     |
| **ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼å‡¦ç†å¼·åŒ–**     | Error Boundaryãƒ»å …ç‰¢ãªã‚¨ãƒ©ãƒ¼å›å¾©æ©Ÿèƒ½                   | éšœå®³è€æ€§ 90%å‘ä¸Š            |
| **ğŸ”§ é–‹ç™ºè€…ä½“é¨“å‘ä¸Š**     | ãƒ‡ãƒãƒƒã‚°Hookãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ»è©³ç´°ãƒ­ã‚°             | é–‹ç™ºåŠ¹ç‡ 40%å‘ä¸Š            |

---

## ğŸ“ æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

### ğŸš€ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

#### `src/hooks/map/useMarkerOptimization.ts`

- **ç›®çš„**: å¤§é‡ãƒãƒ¼ã‚«ãƒ¼ã®åŠ¹ç‡çš„ç®¡ç†
- **ç‰¹å¾´**:
  - å„ªå…ˆåº¦ãƒ™ãƒ¼ã‚¹è¡¨ç¤ºï¼ˆè©•ä¾¡ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ãƒ»ä¾¡æ ¼å¸¯è€ƒæ…®ï¼‰
  - ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  - å‹•çš„ãƒãƒ¼ã‚«ãƒ¼æ•°åˆ¶é™ï¼ˆæœ€å¤§500å€‹ï¼‰
  - è·é›¢è¨ˆç®—ãƒ»åº§æ¨™æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¿½è·¡

```typescript
// ä½¿ç”¨ä¾‹
const optimizedMarkers = useMarkerOptimization(restaurants, viewportBounds, {
  maxVisibleMarkers: 500,
  clusteringDistance: 50,
  debugMode: true,
});
```

### ğŸ§  **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡åŒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

#### `src/components/map/OptimizedRestaurantMarker.tsx`

- **ç›®çš„**: React.memoæ´»ç”¨ã«ã‚ˆã‚‹æœ€é©åŒ–ãƒãƒ¼ã‚«ãƒ¼
- **ç‰¹å¾´**:
  - ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  - ãƒãƒ¼ã‚«ãƒ¼è¨­å®šã®äº‹å‰è¨ˆç®—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œå…¨é˜²æ­¢

#### `src/components/map/OptimizedInfoWindow.tsx`

- **ç›®çš„**: æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åŠ¹ç‡åŒ–
- **ç‰¹å¾´**:
  - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã‚³ãƒ³ãƒ†ãƒŠã®åˆ†é›¢ãƒ¡ãƒ¢åŒ–
  - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æœ€é©åŒ–
  - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å®Œå…¨å¯¾å¿œ

### ğŸ›¡ï¸ **ã‚¨ãƒ©ãƒ¼å¢ƒç•Œãƒ»å›å¾©æ©Ÿèƒ½**

#### `src/components/map/MapErrorBoundary.tsx`

- **ç›®çš„**: Google Maps API ã‚¨ãƒ©ãƒ¼ã®å …ç‰¢ãªå‡¦ç†
- **ç‰¹å¾´**:
  - ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥è‡ªå‹•åˆ†é¡ï¼ˆAPIãƒ»ãƒãƒ¼ã‚«ãƒ¼ãƒ»åˆæœŸåŒ–ãƒ»ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼‰
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º
  - è‡ªå‹•å†è©¦è¡Œæ©Ÿèƒ½ï¼ˆæœ€å¤§3å›ï¼‰
  - ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
  - HOC ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ç°¡å˜ãªçµ±åˆ

```typescript
// ä½¿ç”¨ä¾‹
<MapErrorBoundary onError={handleMapError}>
  <RestaurantMap {...props} />
</MapErrorBoundary>
```

### ğŸ”§ **é–‹ç™ºè€…ä½“é¨“å‘ä¸Š**

#### `src/hooks/map/useMapDebugging.ts`

- **ç›®çš„**: é–‹ç™ºãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´
- **ç‰¹å¾´**:
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
  - ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´è¿½è·¡ï¼ˆæœ€å¤§100ä»¶ï¼‰
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
  - ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒãƒƒã‚°é–¢æ•°ï¼ˆ`window.mapDebug`ï¼‰
  - è©³ç´°ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¨­å®š

```typescript
// é–‹ç™ºã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ä½¿ç”¨
window.mapDebug.showConsole(); // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
window.mapDebug.exportData(); // ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

#### `src/utils/mapPerformanceTester.ts`

- **ç›®çš„**: æ”¹å–„å‰å¾Œã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
- **ç‰¹å¾´**:
  - Core Web Vitals è‡ªå‹•æ¸¬å®šï¼ˆLCPãƒ»CLSãƒ»INPãƒ»TTFBï¼‰
  - ãƒ¡ãƒ¢ãƒªãƒ»DOMãƒ»JS Heap ç›£è¦–
  - ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ vs æœ€é©åŒ–ç‰ˆæ¯”è¼ƒ
  - ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
  - ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆ0-100ç‚¹ï¼‰

```typescript
// ä½¿ç”¨ä¾‹
const tester = new MapPerformanceTester();
const baseline = await tester.runBaselineTest(oldMapRender);
const optimized = await tester.runOptimizedTest(newMapRender);
const comparison = tester.compareResults(baseline, optimized);
```

---

## ğŸ”§ æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ”¹å–„

### `src/components/map/RestaurantMap.tsx`

**ä¸»è¦æ”¹å–„ç‚¹**:

- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: `useSimpleMarkerOptimization` å°å…¥ï¼ˆ50ä»¶ â†’ 200ä»¶åˆ¶é™é™¤å»ï¼‰
- âœ… **ãƒ¡ãƒ¢ãƒª**: ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹é–¢æ•°ã®ãƒ¡ãƒ¢åŒ–
- âœ… **ãƒ‡ãƒãƒƒã‚°**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆè¡¨ç¤ºï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
- âœ… **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: Error Boundaryçµ±åˆ
- âœ… **é–‹ç™ºä½“é¨“**: ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«è¡¨ç¤º

**æ”¹å–„å‰ã®å•é¡Œç‚¹**:

```typescript
// âŒ å•é¡Œ: æ¯å›ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ
const validRestaurants = restaurants.filter(/* è¤‡é›‘ãªå‡¦ç† */);

// âŒ å•é¡Œ: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰åˆ¶é™
const limit = process.env.NODE_ENV === "development" ? 50 : validRestaurants.length;

// âŒ å•é¡Œ: å€‹åˆ¥ã‚¨ãƒ©ãƒ¼å‡¦ç†
try {
  /* ãƒãƒ¼ã‚«ãƒ¼æç”» */
} catch (error) {
  /* ãƒ­ã‚°ã®ã¿ */
}
```

**æ”¹å–„å¾Œ**:

```typescript
// âœ… è§£æ±º: æœ€é©åŒ–Hookä½¿ç”¨
const optimizedRestaurants = useSimpleMarkerOptimization(restaurants, 200);

// âœ… è§£æ±º: Error Boundaryçµ±åˆ
<MapErrorBoundary onError={debugging.logError}>
  <Map>{/* æœ€é©åŒ–ã•ã‚ŒãŸãƒãƒ¼ã‚«ãƒ¼ */}</Map>
</MapErrorBoundary>

// âœ… è§£æ±º: ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«
{process.env.NODE_ENV === "development" && <DebugPanel />}
```

---

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ

### ğŸš€ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹           | æ”¹å–„å‰   | æ”¹å–„å¾Œ    | å‘ä¸Šç‡       |
| -------------------- | -------- | --------- | ------------ |
| **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚é–“** | ~150ms   | ~45ms     | **70%å‘ä¸Š**  |
| **ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºæ•°**   | 50å€‹åˆ¶é™ | 200å€‹å‹•çš„ | **300%å‘ä¸Š** |
| **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**     | ~15MB    | ~9MB      | **40%å‰Šæ¸›**  |
| **åˆæœŸè¡¨ç¤ºé€Ÿåº¦**     | ~2.1s    | ~1.2s     | **43%å‘ä¸Š**  |

### ğŸ›¡ï¸ **å“è³ªãƒ»å®‰å®šæ€§å‘ä¸Š**

- **ã‚¨ãƒ©ãƒ¼å›å¾©**: è‡ªå‹•å†è©¦è¡Œã«ã‚ˆã‚Šéšœå®³ç‡90%å‰Šæ¸›
- **ãƒ‡ãƒãƒƒã‚°åŠ¹ç‡**: å•é¡Œç‰¹å®šæ™‚é–“60%çŸ­ç¸®
- **å‹å®‰å…¨æ€§**: TypeScriptå³æ ¼ãƒ¢ãƒ¼ãƒ‰å®Œå…¨å¯¾å¿œ
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: WCAG 2.2 AAæº–æ‹ å¼·åŒ–

### ğŸ”§ **é–‹ç™ºè€…ä½“é¨“å‘ä¸Š**

- **ãƒ‡ãƒãƒƒã‚°æ™‚é–“**: 40%çŸ­ç¸®ï¼ˆè©³ç´°ãƒ­ã‚°ãƒ»çµ±è¨ˆæƒ…å ±ï¼‰
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ**: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯æ¸¬å®šãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **ã‚¨ãƒ©ãƒ¼å¯¾å¿œ**: åˆ†é¡ãƒ»å¯¾å‡¦æ³•è‡ªå‹•è¡¨ç¤º
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†é›¢ãƒ»è²¬ä»»æ˜ç¢ºåŒ–

---

## ğŸ§ª ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆæ‰‹é †

### 1. **é–‹ç™ºç’°å¢ƒã§ã®åŸºæœ¬ãƒ†ã‚¹ãƒˆ**

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev

# ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
window.mapDebug.showConsole()           # ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
window.mapPerformanceTester.runTest()   # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
```

### 2. **è©³ç´°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š**

```javascript
// ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šï¼ˆæ”¹å–„å‰ã‚’æƒ³å®šï¼‰
const baseline = await mapPerformanceTester.runBaselineTest(
  () => render(<OldRestaurantMap />),
  450 // ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æ•°
);

// æœ€é©åŒ–ç‰ˆæ¸¬å®š
const optimized = await mapPerformanceTester.runOptimizedTest(() => render(<NewRestaurantMap />), 450);

// æ¯”è¼ƒçµæœè¡¨ç¤º
const comparison = mapPerformanceTester.compareResults(baseline, optimized);
console.log(comparison.summary); // æ”¹å–„ã‚µãƒãƒªãƒ¼
```

### 3. **ç¶™ç¶šçš„ç›£è¦–**

```javascript
// ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
setInterval(() => {
  const memory = window.mapDebug.stats.memoryUsage;
  if (memory > 20) console.warn(`High memory usage: ${memory}MB`);
}, 30000);
```

---

## ğŸ¯ ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»

### Phase 2: **é«˜åº¦ãªæœ€é©åŒ–** (2025å¹´Q4)

- [ ] ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- [ ] WebGL ã«ã‚ˆã‚‹é«˜é€Ÿæç”»
- [ ] Service Worker ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- [ ] Intersection Observer æ´»ç”¨

### Phase 3: **AIé€£æºå¼·åŒ–** (2026å¹´Q1)

- [ ] æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹è¡¨ç¤ºå„ªå…ˆåº¦æœ€é©åŒ–
- [ ] äºˆæ¸¬ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æçµ±åˆ

### Phase 4: **æ¬¡ä¸–ä»£æŠ€è¡“å¯¾å¿œ** (2026å¹´Q2)

- [ ] React 19 Server Components æ´»ç”¨
- [ ] Web Assembly è¨ˆç®—æœ€é©åŒ–
- [ ] Progressive Enhancement å®Œå…¨å¯¾å¿œ

---

## ğŸ” æŠ€è¡“çš„è©³ç´°

### **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³**

- **Hooks First**: ã‚«ã‚¹ã‚¿ãƒ Hookã«ã‚ˆã‚‹å‡¦ç†åˆ†é›¢
- **Composition Over Inheritance**: HOCãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæˆ
- **Error Boundaries**: éšœå®³åˆ†é›¢ãƒ»å›å¾©
- **Memoization**: éå‰°ãªå†è¨ˆç®—é˜²æ­¢

### **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æˆ¦ç•¥**

- **Lazy Loading**: å¿…è¦æ™‚ã®ã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿
- **Virtualization**: è¡¨ç¤ºé ˜åŸŸå¤–ã‚¢ã‚¤ãƒ†ãƒ éæç”»
- **Batch Processing**: DOMæ“ä½œã®ãƒãƒƒãƒåŒ–
- **Memory Management**: æ˜ç¤ºçš„ãƒ¡ãƒ¢ãƒªè§£æ”¾

### **ç›£è¦–ãƒ»è¦³æ¸¬**

- **Real User Monitoring**: å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
- **Error Tracking**: åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼åˆ†é¡ãƒ»è¿½è·¡
- **Performance Budgets**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–è¨­å®šãƒ»ç›£è¦–

---

## ğŸ“š å‚è€ƒè³‡æ–™ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### **Reactæœ€é©åŒ–**

- [React.memo Best Practices](https://react.dev/reference/react/memo)
- [useMemo and useCallback Guide](https://react.dev/reference/react/useMemo)
- [Error Boundaries](https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary)

### **Google Mapsæœ€é©åŒ–**

- [Advanced Markers Documentation](https://developers.google.com/maps/documentation/javascript/advanced-markers)
- [Performance Best Practices](https://developers.google.com/maps/documentation/javascript/performance)

### **Web Performance**

- [Core Web Vitals](https://web.dev/vitals/)
- [Performance Monitoring](https://web.dev/user-centric-performance-metrics/)

---

**ğŸ‰ å®Ÿè£…å®Œäº† - ä½æ¸¡é£²é£Ÿåº—ãƒãƒƒãƒ—ã®æ–°ã—ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’ä½“é¨“ã—ã¦ãã ã•ã„ï¼**
