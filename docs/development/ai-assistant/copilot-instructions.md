# GitHub Copilot Instructions

> 🎯 **目的**: React+TypeScript+Google Maps プロジェクト向けの統合開発支援
> **プロジェクト**: 佐渡飲食店マップアプリケーション
> **技術スタック**: React 19, TypeScript 5.7, Vite 7, Google Maps API, PWA

## 🏗️ プロジェクト概要

このプロジェクトは佐渡島の飲食店を紹介する React ベースのマップアプリケーションです。

### 主要技術

- **フロントエンド**: React 19.1 + TypeScript 5.7 + Vite 7.1
- **地図機能**: Google Maps JavaScript API + @vis.gl/react-google-maps v1.5
- **スタイリング**: CSS + レスポンシブデザイン
- **テスト**: Vitest 3.2 + Testing Library
- **PWA**: Service Worker + Manifest + vite-plugin-pwa
- **パッケージ管理**: pnpm

### 重要な特徴

- 🍽️ Google Maps 統合による飲食店マップ
- 🏪 店舗詳細情報・フィルタリング機能
- 📱 レスポンシブ・モバイルファースト設計
- ⚡ Vite による高速開発・ビルド
- 🏃‍♂️ PWA 対応（オフライン機能）
- 🔍 検索・フィルタリング機能
- 🧪 包括的なテストカバレッジ
- 🔧 開発者体験最適化
- 📁 **整理されたプロジェクト構造**

## 🎯 コード作成・修正の基本方針

### 1. TypeScript 優先

- 厳格な型定義を必須とする
- `any`の使用を避け、適切な型を定義
- Generics、Union Types を積極活用
- 型ガードとユーザー定義型ガード関数を使用

### 2. React 現代的パターン

- 関数コンポーネント + Hooks のみ使用
- `memo`、`useMemo`、`useCallback`で適切にメモ化
- Custom Hooks で状態ロジックを分離
- Suspense、Error Boundary で堅牢性を確保
- Concurrent Features 活用（startTransition、useDeferredValue）

### 3. パフォーマンス重視

- Code Splitting（React.lazy）を積極使用
- 画像・アセットの遅延読み込み
- Google Maps API 呼び出しの最適化
- 不要な再レンダリングの防止

### 4. アクセシビリティ・UX

- WCAG 2.2 AA 準拠
- セマンティック HTML、適切な ARIA 属性
- キーボードナビゲーション対応
- スクリーンリーダー対応
- カラーコントラスト対応
- 動作縮小設定対応（prefers-reduced-motion）

## 🛠️ 開発ガイドライン

### 🔍 **実装分析の正確性確保**

#### 実装状況調査の必須原則

- **実装ファイル直接確認を最優先**: ドキュメントより実際のコードを信頼
- **進捗率の検証**: ドキュメント記載を鵜呑みにせず、実装の実態を確認
- **ファイルサイズ・複雑性確認**: 行数・クラス構造で実装度を客観評価
- **計画書 vs 実装の区別**: 設計例と実装済みコードを明確に分離

#### 調査手順（Phase 3 実装の場合）

1. **tools/scraper/shared/** ディレクトリの直接確認
2. **cache_service.py, celery_config.py, smart_orchestrator.py, ml_engine.py** の実装状況確認
3. **ファイルヘッダー・クラス定義・実装行数** の詳細チェック
4. **import・依存関係・機能実装** の検証

#### 進捗率評価基準

- **0-20%**: 基本構造、主に TODO
- **21-50%**: コアクラス定義、部分実装
- **51-80%**: 主要機能実装、テスト必要
- **81-95%**: 完全実装、微調整のみ
- **96-100%**: 本番対応、テスト完了

### プロジェクト構造

```text
プロジェクトルート/
├── 📄 package.json, tsconfig.*.json    # 設定ファイル
├── 📄 index.html, vite.config.ts       # ビルド・エントリーポイント
├── src/                               # ソースコード
│   ├── components/                     # React コンポーネント
│   │   ├── common/                     # 汎用UIコンポーネント
│   │   ├── layout/                     # レイアウトコンポーネント
│   │   ├── map/                        # Google Maps関連
│   │   └── restaurant/                 # 飲食店関連
│   ├── hooks/                          # カスタムHooks
│   │   ├── api/                        # API関連フック
│   │   ├── map/                        # 地図関連フック
│   │   └── ui/                         # UI関連フック
│   ├── services/                       # 外部API・サービス連携
│   ├── types/                          # TypeScript型定義
│   ├── utils/                          # ユーティリティ関数
│   ├── config/                         # 設定・定数管理
│   └── styles/                         # CSSファイル
├── 📁 docs/                            # ドキュメント（プロジェクト全体）
│   ├── development/                    # 開発支援・環境設定
│   │   ├── guides/                     # 環境構築・設定ガイド
│   │   ├── ai-assistant/               # AI開発支援
│   │   ├── automation/                 # CI/CD・自動化
│   │   ├── documentation/              # ドキュメント管理
│   │   └── security/                   # セキュリティ・品質管理
│   ├── architecture/                   # アーキテクチャ決定記録
│   ├── analysis/                       # システム分析・技術レポート
│   ├── planning/                       # ロードマップ・計画
│   ├── reports/                        # 実装レポート
│   └── testing/                        # テスト戦略・統合テスト
├── 📁 tools/                           # 開発ツール
└── 📁 config/, public/                 # 設定・静的ファイル
```

### ファイル・ディレクトリ命名規則

- **コンポーネント**: `PascalCase.tsx` (例: `MapView.tsx`)
- **Hooks**: `use*.ts` (例: `useMapState.ts`)
- **型定義**: `*.types.ts` (例: `restaurant.types.ts`)
- **ユーティリティ**: `camelCase.ts` (例: `formatAddress.ts`)
- **定数**: `*.constants.ts` (例: `map.constants.ts`)

### コーディング標準

- ESLint + Prettier 設定に準拠
- コメントは英語で記述（ユーザー向けは日本語）
- 1 ファイル 300 行以内を目標
- 関数は 1 つの責任のみ持つ
- 副作用のある処理は明確に分離

## 🎯 特化した対応方針

### Google Maps 統合

- Advanced Markers を最優先使用
- `@vis.gl/react-google-maps`ライブラリを優先使用
- マーカークラスタリングでパフォーマンス最適化
- InfoWindow、カスタムコントロールの適切な実装
- 地図の状態管理とメモ化に注意
- Maps JavaScript API の効率的な使用

### PWA・モバイル対応

- Service Worker でオフライン対応
- Manifest による PWA 対応
- Touch 操作、ジェスチャーサポート
- Critical CSS で FCP 最適化
- レスポンシブデザイン

### エラーハンドリング

- グローバルエラーバウンダリ
- ネットワークエラーの適切な処理
- ユーザーフレンドリーなエラーメッセージ
- 開発時は詳細ログ、本番時は最小ログ

## 🚀 開発支援機能

### 自動的な対応

#### 📊 **実装分析の精度向上**

- **実装ファイル優先調査**: tools/scraper/shared/等の実装ディレクトリを最優先確認
- **進捗率検証**: ドキュメント記載値と実装の実態との照合
- **コード vs 計画の識別**: 設計コード例と実装済みコードの明確な区別
- **客観的評価基準**: ファイルサイズ・クラス実装度による定量的評価

#### コード品質

- TypeScript 型エラーの自動検出・修正提案
- 未使用 import/変数の削除提案
- パフォーマンス改善の自動提案
- アクセシビリティ問題の指摘

#### Google Maps 特化

- Advanced Markers への移行サポート
- API 使用量最適化の提案
- マーカー・InfoWindow の効率的な実装
- 地図イベントハンドリングのベストプラクティス
- カスタムコントロールの適切な実装

#### PWA 最適化

- Service Worker 実装のサポート
- Manifest 対応への移行
- キャッシュ戦略の最適化提案
- オフライン対応の実装支援

### コンテキスト認識

#### プロジェクト固有の知識

- 佐渡島の地理的特性を考慮
- 飲食店アプリとしての UX 要件
- 日本語・多言語対応の考慮
- モバイル利用シーンの想定
- **整理されたプロジェクト構造の活用**
- **ドキュメント一括管理方針**: 個別 README vs プロジェクト全体 docs/の使い分け

## 🔧 統合プロンプト対応

### ai-prompts.md 連携

ユーザーが `#番号` 形式でプロンプトを指定した場合：

- **#1-#6**: 基本的なコード改善（修正、整理、最適化、リファクタ、モダナイズ、包括改善）
- **#7-#9**: 専門的な改善（環境、フロントエンド、プロジェクト構造）
- **#10-#12**: 診断・メンテナンス（プロジェクト診断、ディレクトリ診断、緊急対応）

各プロンプトに対して、プロジェクト特性を考慮した具体的な改善を提案する。

### 優先度付き対応

1. **Critical**: セキュリティ、アクセシビリティ、型安全性
2. **High**: パフォーマンス、ユーザビリティ、Google Maps 最適化
3. **Medium**: コード品質、保守性、テスト
4. **Low**: スタイル、コメント、ドキュメント

### ファイル配置の自動提案

#### コードファイル

- 新規コンポーネント → `src/components/[category]/`
- 開発ツール → `tools/[category]/`

#### ドキュメントファイル

- **プロジェクト全体ドキュメント** → `docs/[category]/`

  - システム分析・技術レポート → `docs/analysis/`
  - アーキテクチャ決定記録 → `docs/architecture/`
  - 開発ガイド・環境設定 → `docs/development/`
  - 企画・計画・ロードマップ → `docs/planning/`
  - 実装完了レポート → `docs/reports/`
  - テスト戦略・統合テスト → `docs/testing/`

- **個別ディレクトリ特化ドキュメント** → `[tool]/README.md`
  - スクレイパー操作ガイド → `tools/scraper/README.md`
  - フロントエンド実装ガイド → `src/README.md`
  - 各サブシステムの使用方法・開発ガイド

#### ドキュメント配置原則

- **README.md**: 個別ディレクトリの操作・開発方法に特化
- **その他ドキュメント**: プロジェクト全体で`docs/`に一括管理
- **技術レポート・分析**: `docs/analysis/`で集約管理
- **重複回避**: 同一内容の複数配置を避ける

### README 配置・品質ベストプラクティス

#### 配置基準マトリックス

| ディレクトリレベル | 配置必要性  | 主な内容                          | 文量目安     |
| ------------------ | ----------- | --------------------------------- | ------------ |
| **ルート**         | ✅ 必須     | プロジェクト全体概要              | 1000-2000 行 |
| **主要セクション** | ✅ 必須     | セクション全体説明+ナビゲーション | 300-800 行   |
| **機能グループ**   | ⚡ 推奨     | 機能群の概要+使用方法             | 200-500 行   |
| **個別機能**       | 🔶 条件付き | 複雑な機能の詳細説明              | 100-300 行   |
| **ユーティリティ** | ❌ 通常不要 | 単純な関数・設定                  | -            |

#### 配置判断基準

**✅ README 配置が必要**:

- 複雑なロジック・アルゴリズム
- 外部 API・ライブラリとの統合
- 設定・環境変数が必要
- 複数ファイルで構成
- 他の開発者が使用する可能性

**❌ README 配置不要**:

- 単一ファイル・単純機能ディレクトリ
- 自明な内容（ファイル名から機能が明確）
- 設定ファイルのみのディレクトリ
- アセットディレクトリ（画像・静的ファイルのみ）

#### 品質原則（SCRAP 原則）

- **S**pecific: 具体的な情報
- **C**oncise: 簡潔で要点を絞る
- **R**elevant: 読み手に関連性のある情報
- **A**ctionable: 実行可能な手順
- **P**ractical: 実用的な例・コード

#### 構造化テンプレート指針

**Level 1 (ルート)**:

```markdown
# プロジェクト名

> 🎯 1 行での価値提案

## ✨ 主な機能 (3-5 個)

## 🚀 クイックスタート (30 秒で動く)

## 🛠️ 技術スタック

## 📁 プロジェクト構造

## 🔧 開発コマンド

## 📄 ライセンス・コントリビューション
```

**Level 2 (セクション)**:

```markdown
# セクション名

> 🎯 このセクションの役割

## 📁 構成 (視覚的な tree 表示)

## 🚀 使用方法 (コード例付き)

## 🏗️ アーキテクチャ原則

## 📋 開発ガイドライン

## 🔗 関連ドキュメント
```

#### 更新・メンテナンスルール

- **即座更新**: Level 1 (ルート) - 主要機能追加・削除時
- **週次更新**: Level 2 (セクション) - 新規ディレクトリ追加時
- **月次更新**: Level 3 (機能) - 詳細仕様変更時
- **四半期見直し**: 全体構造の最適化・リファクタリング

#### 品質チェックリスト

**作成時**:

- [ ] 対象読者が明確
- [ ] 30 秒で概要理解可能
- [ ] コード例が動作する
- [ ] リンクが正しい
- [ ] 将来の変更に対応可能

**更新時**:

- [ ] 古い情報の削除
- [ ] 新機能の追加
- [ ] リンク整合性確認
- [ ] 他 README との重複チェック

## 📚 参照すべき技術情報

### 必須ドキュメント

- React 19 公式ドキュメント
- TypeScript 5.7 ハンドブック
- Google Maps JavaScript API + Advanced Markers
- @vis.gl/react-google-maps v1.5
- Vite 7.0 公式ガイド
- WCAG 2.2 アクセシビリティガイドライン
- PWA Manifest 仕様

### コード例の提供

- **整理されたプロジェクト構造**に合わせた実装例
- TypeScript 型定義のベストプラクティス
- Google Maps 統合の効率的なパターン
- PWA 実装の段階的ガイド
- **適切なディレクトリ配置**を考慮したファイル作成例
- **ドキュメント管理**: 個別 README 作成 vs docs/配置の判断基準
- **README 品質向上**: SCRAP 原則に基づく構造化テンプレート適用
- **情報アーキテクチャ**: MECE 原則（相互排他・完全網羅）での重複回避

## 🎯 応答スタイル

### 基本姿勢

- **実用性優先**: 理論より実装可能な解決策
- **段階的改善**: 大きな変更は小分けして提案
- **リスク考慮**: 変更による影響を事前に説明
- **テスト重視**: 変更後のテスト方法も併せて提案
- **構造保持**: 整理されたプロジェクト構造の維持・活用

### コミュニケーション

- 日本語でユーザーフレンドリーに説明
- 技術的な根拠を簡潔に提示
- 代替案がある場合は選択肢を提供
- 実装の優先度を明確に示す
- **適切なファイル配置場所**を提案に含める
- **ドキュメント管理方針**に従った配置提案

---

**最終更新**: 2025 年 9 月 7 日
**連携ファイル**: `ai-prompts.md` (同ディレクトリ)
